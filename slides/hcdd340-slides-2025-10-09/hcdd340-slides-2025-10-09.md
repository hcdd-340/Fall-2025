---
pagetitle: HCDD 340 — 2025-10-09
date-meta: 2025-10-09
author-meta: Saeed Abdullah (saeed@psu.edu)
revealjs-url: ../reveal.js
theme: hcdd340-dark
slideNumber: true
hash: true
hashOneBasedIndex: true
highlightjs: true
highlightjs-theme: dracula
---

## JS V

---

## Today

* Adding and removing DOM nodes
* Keyboard events
* Data storage

---

## Recap from last class

* Asynchronous JS (`async` and `await`)
* Adding and removing DOM nodes

---

### `async` and `await`
Instead of using `then()` method

```js
async function getData() {
    const url = "colleges.json"
    const response  = await fetch(url);
    console.log(`Received response: ${response.status}`);

}
```



---

### `async` and `await`
```js{data-line-numbers="1"}
async function getData() {
    const url = "colleges.json"
    const response  = await fetch(url);
    console.log(`Received response: ${response.status}`);

}
```

`async` marks that it is an asynchronous function

---


### `async` and `await`
```js{data-line-numbers="3"}
async function getData() {
    const url = "colleges.json"
    const response  = await fetch(url);
    console.log(`Received response: ${response.status}`);

}
```

`await` will cause the function to 'freeze' till the `Promise` is resolved

---


### `async` and `await`

```js
const url = "colleges.json"
const fetchPromise = fetch(url);
fetchPromise
  .then((response) => response.json())
  .then((data) => {
    console.log(data[0].name);
  });
```
[**==**]{.t-salmon}

```js
const getData = async () => {
    const url = "colleges.json"
    const response = await fetch(url);
    const data = await response.json()
    console.log(data[0].name)
}
```

---

### `async` and `await`

```js
const getJson = async (url) => {
    const response = await fetch(url);
    if (!response.ok) {
        throw new Error(`Error! ${response}`)
    }
    const data = await response.json()
    console.log(data[0].name)
    return data;
}
```
```js
// Calling it from another `async` function
try {
    let colleges = await getJson("colleges.json");
} catch(error) {
    console.error(error);
}
```


---

## Recap from last class

* Asynchronous JS (`async` and `await`)
* **Adding and removing DOM nodes**



---



### We can add and remove nodes using JS

---

### Adding a new node
#### 3 steps

* Create a node
* Set values and attributes
* Attach it to the DOM tree

---

### Creating a node
#### `createElement()`

```js
const newDiv = document.createElement("div");
const p = document.createElement("p");
```

String argument specifying the types of element

---

### Creating a text node
#### `createTextNode()`

```js
const newText = document.createTextNode("HCDD 340");
```

String argument for the text

---

### Adding a new node
#### 3 steps

* Create a node
* **Set values and attributes**
* Attach it to the DOM tree

---

### Setting attributes
#### `setAttribute()`


```js

const p = document.createElement("p");
// set id
p.setAttribute("id", "new-id");

// setting css class
p.setAttribute("class", "large-text");

```

Two arguments: `name` and `value`

---

### Setting `class` attribute
#### Multiple options ([examples](https://developer.mozilla.org/en-US/docs/Web/API/Element/classList#examples))

```
const div = document.createElement("div");

div.className = "foo";
// <div class="foo"></div>

// add 3 classes
div.classList.add("foo", "bar", "baz");

// removes two classes
div.classList.remove("foo", "bar");

// if visible is set remove it, otherwise add it
div.classList.toggle("visible");
```

---


### Adding a new node
#### 3 steps

* Create a node
* Set values and attributes
* **Attach it to the DOM tree**

---

#### `appendChild()`


```js
const sect = document.querySelector("section");
const para = document.createElement("p");

// add at the end of the section
sect.appendChild(para);
```

Appends a node to the parent

:::{.t-ref}
[Source](https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild)
:::

---


#### `insertBefore()`


```html
<div id="parent">
  <span id="child">foo</span>
</div>
```


```js
// Create a new, plain <span> element
const sp1 = document.createElement("span");

// Get the reference element
const sp2 = document.getElementById("child");
// Get the parent element
const parentDiv = sp2.parentNode;

// Insert the new element into before sp2
parentDiv.insertBefore(sp1, sp2);
```

The new node will be placed before a _reference_ node

---

#### `after()`

```js
let container = document.createElement("div");
let p = document.createElement("p");
container.appendChild(p);
let span = document.createElement("span");

p.after(span);

// "<div><p></p><span></span></div>"

```

Insert the node after a given node

:::{.t-ref}
[Source](https://developer.mozilla.org/en-US/docs/Web/API/Element/after)
:::

---

#### `after()` for `text` node

```js
let container = document.createElement("div");
let p = document.createElement("p");
container.appendChild(p);

p.after("Text");
// "<div><p></p>Text</div>"
```

"Strings are inserted as equivalent Text nodes"

:::{.t-ref}
[Source](https://developer.mozilla.org/en-US/docs/Web/API/Element/after)
:::


---

### Removing elements
#### `removeChild()`

```html
<div id="parent">
  <div id="child"></div>
</div>
```

```js
const parent = document.getElementById("parent");
const child = document.getElementById("child");
const throwawayNode = parent.removeChild(child);
```

Removes the child node from the parent

---

### Removing elements

```js
const node = document.getElementById("child");
node.parentNode.removeChild(node);
```

`parentNode` points to the parent

---

## Today

* [**Adding and removing DOM nodes**]{.t-salmon}
* Keyboard events
* Data storage

---

## Todo
* Open [Activity 17](https://github.com/hcdd-340/Activity-Fall-2025/releases/tag/activity-17.0)
* Update `main.js`
    + Add nodes when a button is clicked
    + see `output.html` for the final outcome

---

### Hints
#### Start with `Overview` section
* Update `addOverviewContent` in `main.js`
* 3 elements
    + Image
    + `H2`
    + Text

* What's the parent root for these elements?

---

### Hints II
#### Header
* Update `addHeaderContent` in `main.js`
* What are the components?

---


### Hints III
#### Objective
* Update `addObjectiveContent` in `main.js`
* Two components
    + `H2`
    + `list`
* What's the parent element?
* How would you add the new parent element?

---


## Today

* Adding and removing DOM nodes
* [**Keyboard events**]{.t-salmon}
* Data storage

---

### Keyboard events

* To get text entered by your user, we usually rely on button clicks (e.g., "Submit")
* Button click indicates user is done with text entering
* Then, we can extract the text

```html
<input type="text" name="module" id="module">
<button id="btn_add">Add a module!</button>
```

```js
const addModule = (event) => {
    const input = document.querySelector('input');
    const moduleName = input.value;

};
```

:::{.t-ref}
[Source](https://eloquentjavascript.net/15_event.html#h-974t15Z9oa)
:::

---

#### However, some use cases require handling keyboard events directly (e.g., games, shortcuts)

---


### Keyboard events

* Key is pressed — [keydown](https://developer.mozilla.org/en-US/docs/Web/API/Element/keydown_event) event
* Key is released — [keyup](https://developer.mozilla.org/en-US/docs/Web/API/Element/keyup_event) event

```js

target.addEventListener("keydown", (event) => { 
    /* Key pressed */
});

target.addEventListener("keyup", (event) => { 
    /* Key released */
});

```

---

### Keyboard events
#### The [`event` object](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent) contains key information

* `key`: value of the key pressed
* `ctrlKey`: was `Ctrl` key active?
* `shiftKey`: was `Shift` key active?
* `metaKey`: was the meta key active?
    - ⌘ in Mac, ⊞ in Windows

---

## Todo

* Open [Activity 18](https://github.com/hcdd-340/Activity-Fall-2025/releases/tag/activity-18.0)
* What happens if you press the "v" key?

---

### Keyboard events

```js
window.addEventListener("keydown", event => {
    if (event.key == "v") {
        document.body.style.background = "violet";
    }
});
window.addEventListener("keyup", event => {
    if (event.key == "v") {
        document.body.style.background = "";
    }
});

```

"Page turns violet when you hold the V key"

:::{.t-ref}
[Source](https://eloquentjavascript.net/15_event.html#h-974t15Z9oa)
:::

---

#### Which element is the event listener?

```js {data-line-numbers="1,6"}
window.addEventListener("keydown", event => {
    if (event.key == "v") {
        document.body.style.background = "violet";
    }
});
window.addEventListener("keyup", event => {
    if (event.key == "v") {
        document.body.style.background = "";
    }
});

```


:::{.t-ref}
[Source](https://eloquentjavascript.net/15_event.html#h-974t15Z9oa)
:::

---

#### `window` contains the `DOM` document

![](./images/window-dom.png){style="max-width: 440px;"}

`window` makes items globally available (functions, event handlers, objects)

---




## Todo
* Log the key values in both event handlers
* What happens when you press
    - 'Enter', 'Delete', 'Tab'?
    - 'Shift', 'Ctrl', 'Meta' key with another key?
* What happens when you hold down a key?

---

## Todo
::::{.columns style="justify-content: center;"}

:::{.column width="60%"}
* Open [Activity 18](https://github.com/hcdd-340/Activity-Fall-2025/releases/tag/activity-18.0)
* The balloon should:
    - Inflate 20% when ⬆️  is pressed
    - Deflate 20% when ⬇️  is pressed

::::
:::{.column width="40%"}
<video
data-autoplay
src="./images/hcdd-340-activity-18.mp4"></video>
:::
::::

:::{.t-ref}
[Source](https://eloquentjavascript.net/15_event.html#h-974t15Z9oa)
:::

---

### Hints
* What does the console show when ⬆️  and  ⬇️   is pressed?
* `style.fontSize` will change font for a given element
    - Remember to include the unit (e..g, `px`, `rem`, `em`)

---

## Today

* Adding and removing DOM nodes
* Keyboard events
* [**Data storage**]{.t-salmon}

---

### Data storage
#### Client side storage

* JS enables data storage in users' machines 
    - browser, app

* Cookies
    - Simple data
* Web Storage
    - Simple data
* IndexedDB
    - Complex data

---

### Client side storage
#### We will focus on Web Storage in this class

* ~~Cookies~~
* Web Storage
* ~~IndexedDB~~
    - Complex data


---

### Web Storage

* Storing data for different origins (e.g., hostname)
* You can't access data for other origins
    - Security

* There is a limit
    - Around 5 MiB of local storage _per origin_

:::{.t-ref}
[Source](https://developer.mozilla.org/en-US/docs/Web/API/Storage_API/Storage_quotas_and_eviction_criteria#web_storage)
::::

---

### Web Storage
#### Use cases

* Saving preferences (e.g., color scheme, font size)
* Previous site activity (e.g., shopping cart, login info)
* Saving documents for offline use

---


### Web Storage
* `sessionStorage`
    + Persists data for as long as the browser is open
    + Data is lost when browser is closed
* `localStorage`
    + Persists data **even after** the browser is closed

:::{.t-ref}
[Source](https://developer.mozilla.org/en-US/docs/Learn_web_development/Extensions/Client-side_APIs/Client-side_storage#storing_simple_data_%E2%80%94_web_storage)
:::

---

### Saving data in `localStorage`
* `setItem(key, value)`
    + Save a data item
    + Both `key` and `value` must be strings

```js
localStorage.setItem("bgcolor", "red");
localStorage.setItem("font", "Helvetica");
localStorage.setItem("image", "myCat.png");
```

:::{.t-ref}
[Source](https://developer.mozilla.org/en-US/docs/Web/API/Storage/setItem)
:::

---

### Getting data from `localStorage`
* `getItem(key)`
    + Return the string data for a given key
    + `null`, if the key doesn't exist

```js
const currentColor = localStorage.getItem("bgcolor");
const currentFont = localStorage.getItem("font");
const currentImage = localStorage.getItem("image");
```

:::{.t-ref}
[Source](https://developer.mozilla.org/en-US/docs/Web/API/Storage/getItem)
:::

---

### Removing data from `localStorage`
* `removeItem(key)`
    + Deletes the data item for a given key

```js
localStorage.removeItem("image");
```

:::{.t-ref}
[Source](https://developer.mozilla.org/en-US/docs/Web/API/Storage/removeItem)
:::


---

### Todo
#### Adding data item to local storage

* Open [Activity 19](https://github.com/hcdd-340/Activity-Fall-2025/releases/tag/activity-19.0) in Chrome/Firefox
* Go to Dev Tools --> Console

```js
localStorage.setItem("button_label", "Add a module!");
localStorage.setItem("name", "YOUR NAME");

sessionStorage.setItem("session_key_1", "Session Value 1");
sessionStorage.setItem("session_key_2", "Session Value 2");
```

---

### Todo
* Go to:
    + Firefox: Dev Tools --> Storage
    + Chrome: Dev Tools --> Application --> Storage

* Do you see the stored values?

---

## Todo
* Restart the browser and reopen `index.html`
* Go to:
    + Firefox: Dev Tools --> Storage
    + Chrome: Dev Tools --> Application --> Storage

* Which values persisted?

---

## Todo
* Open [Activity 19](https://github.com/hcdd-340/Activity-Fall-2025/releases/tag/activity-19.0) in **VS Code**
* Copy the url and open it in Firefox/Chrome
* Go to:
    + Firefox: Dev Tools --> Storage
    + Chrome: Dev Tools --> Application --> Storage

* Do you see the stored values?
    + Why?

---

### Web Storage

* Storing data for different origins (e.g., hostname)
* You can't access data for other origins
    - Security

---

